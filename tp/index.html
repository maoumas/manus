<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puma Studio | Teleprompter Inteligente</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Ocultar scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Estilos específicos para la lectura */
        .prompter-h1 { color: #22d3ee; font-weight: 900; text-transform: uppercase; margin-bottom: 0.5em; margin-top: 1em; line-height: 1.1; }
        .prompter-bold { color: #facc15; font-weight: 800; } /* Amarillo para énfasis */
        .prompter-list { margin-left: 1em; display: block; border-left: 4px solid #4b5563; padding-left: 1em; margin-bottom: 1em; }
        
        /* Cursor pulsante cuando está vacío */
        [contenteditable]:empty:before {
            content: 'Pega aquí tu guion de IA (Markdown)...';
            color: #4b5563;
            font-style: italic;
        }
    </style>
</head>
<body class="bg-black text-white h-screen flex flex-col overflow-hidden selection:bg-indigo-500 selection:text-white">
    
    <header class="h-16 border-b border-gray-800 flex items-center justify-between px-6 bg-gray-900/80 backdrop-blur z-20">
        <div class="flex items-center gap-2 text-indigo-500 font-bold tracking-wider">
            <i data-lucide="mic-2" class="w-5 h-5"></i> PUMA STUDIO
        </div>
        
        <div class="flex items-center gap-4">
            <button onclick="cleanMarkdown()" class="flex items-center gap-2 bg-gray-800 hover:bg-gray-700 text-gray-200 px-4 py-1.5 rounded-full text-xs font-bold transition-all border border-gray-700 hover:border-indigo-500 group">
                <i data-lucide="sparkles" class="w-4 h-4 text-yellow-400 group-hover:rotate-12 transition-transform"></i>
                <span class="hidden sm:inline">Limpiar IA / Markdown</span>
            </button>
            <div class="h-4 w-px bg-gray-700"></div>
            <a href="../index.html" class="text-xs font-medium text-gray-500 hover:text-white transition-colors">Salir</a>
        </div>
    </header>

    <main class="flex-1 relative overflow-hidden flex justify-center bg-black">
        <div class="absolute top-[35%] left-0 w-full h-24 border-y-2 border-indigo-500/20 bg-indigo-500/5 z-10 pointer-events-none flex items-center justify-between px-4">
            <i data-lucide="triangle" class="w-4 h-4 text-indigo-500/50 rotate-90"></i>
            <i data-lucide="triangle" class="w-4 h-4 text-indigo-500/50 -rotate-90"></i>
        </div>

        <div id="scroll-container" 
             class="w-full max-w-5xl px-8 py-[40vh] overflow-y-auto h-full scroll-smooth no-scrollbar text-center outline-none text-5xl md:text-6xl font-semibold leading-snug text-gray-200" 
             contenteditable="true"
             spellcheck="false">
        </div>
    </main>

    <footer class="h-24 bg-gray-900 border-t border-gray-800 flex items-center justify-center gap-6 md:gap-12 px-6 z-20 shadow-[0_-10px_40px_rgba(0,0,0,0.5)]">
        
        <button onclick="toggleMirror()" class="p-3 rounded-xl text-gray-500 hover:text-white hover:bg-gray-800 transition hidden md:block" title="Modo Espejo">
            <i data-lucide="flip-horizontal" class="w-5 h-5"></i>
        </button>

        <div class="flex flex-col items-center gap-1 w-32 md:w-48">
            <div class="flex justify-between w-full text-[10px] text-gray-500 font-mono uppercase">
                <span>Lento</span>
                <span>Rápido</span>
            </div>
            <input type="range" id="speed" min="1" max="100" value="20" class="w-full accent-indigo-500 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer">
        </div>

        <button id="toggleBtn" onclick="toggleScroll()" class="w-16 h-16 bg-indigo-600 hover:bg-indigo-500 rounded-2xl flex items-center justify-center text-white shadow-xl shadow-indigo-900/20 transition-all hover:scale-105 hover:-translate-y-1 active:scale-95 active:translate-y-0 border border-indigo-400/20">
            <i data-lucide="play" class="w-8 h-8 ml-1 fill-white" id="playIcon"></i>
        </button>

        <div class="flex items-center gap-2">
            <button onclick="changeFontSize(-1)" class="w-10 h-10 rounded-lg bg-gray-800 hover:bg-gray-700 text-white flex items-center justify-center border border-gray-700"><i data-lucide="minus" class="w-4 h-4"></i></button>
            <div class="flex flex-col items-center w-8">
                <span class="text-xs font-bold text-gray-400">AA</span>
            </div>
            <button onclick="changeFontSize(1)" class="w-10 h-10 rounded-lg bg-gray-800 hover:bg-gray-700 text-white flex items-center justify-center border border-gray-700"><i data-lucide="plus" class="w-4 h-4"></i></button>
        </div>
        
        <button onclick="resetScroll()" class="p-3 rounded-xl text-gray-500 hover:text-white hover:bg-gray-800 transition hidden md:block" title="Reiniciar">
            <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
        </button>
    </footer>

    <script>
        lucide.createIcons();
        
        // Elementos
        const container = document.getElementById('scroll-container');
        const speedInput = document.getElementById('speed');
        const toggleBtn = document.getElementById('toggleBtn');
        const playIcon = document.getElementById('playIcon');

        // Estado
        let isScrolling = false;
        let scrollFrameId;
        let lastTimestamp = 0;
        let scrollAccumulator = 0;
        let currentFontSize = 60; // px

        // 1. LÓGICA DE SCROLL SUAVE (High Performance)
        function step(timestamp) {
            if (!isScrolling) return;

            if (lastTimestamp === 0) lastTimestamp = timestamp;
            const delta = timestamp - lastTimestamp;
            lastTimestamp = timestamp;

            // Velocidad base
            const speedValue = parseInt(speedInput.value);
            // Factor de velocidad (ajustar para sensación natural)
            const pixelsPerSecond = speedValue * 3; 
            
            scrollAccumulator += (pixelsPerSecond * delta) / 1000;

            if (scrollAccumulator >= 1) {
                const pixelsToScroll = Math.floor(scrollAccumulator);
                container.scrollTop += pixelsToScroll;
                scrollAccumulator -= pixelsToScroll;
            }

            // Loop infinito si no ha llegado al final
            if ((container.scrollTop + container.clientHeight) < container.scrollHeight) {
                scrollFrameId = requestAnimationFrame(step);
            } else {
                toggleScroll(); // Pausar al llegar al final
            }
        }

        function toggleScroll() {
            isScrolling = !isScrolling;
            if (isScrolling) {
                // Cambiar a PAUSE UI
                toggleBtn.classList.replace('bg-indigo-600', 'bg-red-600');
                toggleBtn.classList.replace('hover:bg-indigo-500', 'hover:bg-red-500');
                toggleBtn.innerHTML = '<i data-lucide="pause" class="w-8 h-8 fill-white"></i>';
                lucide.createIcons();
                lastTimestamp = 0;
                scrollFrameId = requestAnimationFrame(step);
            } else {
                // Cambiar a PLAY UI
                toggleBtn.classList.replace('bg-red-600', 'bg-indigo-600');
                toggleBtn.classList.replace('hover:bg-red-500', 'hover:bg-indigo-500');
                toggleBtn.innerHTML = '<i data-lucide="play" class="w-8 h-8 ml-1 fill-white"></i>';
                lucide.createIcons();
                cancelAnimationFrame(scrollFrameId);
            }
        }

        function resetScroll() {
            isScrolling = false;
            cancelAnimationFrame(scrollFrameId);
            container.scrollTop = 0;
            // Restaurar botón
            toggleBtn.classList.replace('bg-red-600', 'bg-indigo-600');
            toggleBtn.innerHTML = '<i data-lucide="play" class="w-8 h-8 ml-1 fill-white"></i>';
            lucide.createIcons();
        }

        // 2. LÓGICA DE LIMPIEZA MARKDOWN (La Magia)
        function cleanMarkdown() {
            let text = container.innerText; // Obtener texto puro, sin HTML previo

            // Si está vacío, no hacer nada
            if (!text.trim()) return;

            // --- PROCESADOR DE TEXTO ---
            
            // 1. Escapar HTML para seguridad (básico)
            text = text.replace(/</g, "&lt;").replace(/>/g, "&gt;");

            // 2. Eliminar bloques de código o basura de IA tipo "Here is your script:"
            // (Opcional: aquí podrías filtrar frases comunes si quisieras)

            // 3. Títulos (## Titulo) -> H1 Visual (Cyan)
            text = text.replace(/^#{1,6}\s+(.+)$/gm, '<div class="prompter-h1">$1</div>');

            // 4. Negritas (**texto**) -> Amarillo Enfático
            text = text.replace(/\*\*(.+?)\*\*/g, '<span class="prompter-bold">$1</span>');
            text = text.replace(/__(.+?)__/g, '<span class="prompter-bold">$1</span>');

            // 5. Listas (- item) -> Bloques indentados
            text = text.replace(/^[\-\*]\s+(.+)$/gm, '<div class="prompter-list">• $1</div>');

            // 6. Líneas horizontales (---) -> Espacio grande
            text = text.replace(/^\s*[\-\*]{3,}\s*$/gm, '<br><br><div class="h-px bg-gray-700 w-1/2 mx-auto my-8"></div><br>');

            // 7. Enlaces [Texto](url) -> Solo Texto
            text = text.replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1');

            // 8. Convertir saltos de línea en <br>
            text = text.replace(/\n/g, '<br>');

            // Aplicar al contenedor
            container.innerHTML = text;
        }

        // 3. UTILIDADES
        function changeFontSize(dir) {
            currentFontSize += (dir * 4);
            if (currentFontSize < 20) currentFontSize = 20;
            if (currentFontSize > 120) currentFontSize = 120;
            container.style.fontSize = `${currentFontSize}px`;
        }

        function toggleMirror() {
            container.classList.toggle('-scale-x-100');
        }

        // Manejar el pegado de texto para que sea texto plano al inicio
        container.addEventListener('paste', function(e) {
            e.preventDefault();
            var text = (e.originalEvent || e).clipboardData.getData('text/plain');
            document.execCommand("insertText", false, text);
        });

    </script>
</body>
</html>
